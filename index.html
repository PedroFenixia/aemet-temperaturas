<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Temperaturas AEMET - Capitales de provincia</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0f172a;--surface:#1e293b;--surface2:#334155;--border:#475569;
  --text:#f1f5f9;--muted:#94a3b8;--blue:#3b82f6;--red:#ef4444;
  --orange:#f97316;--cyan:#06b6d4;--green:#22c55e;--purple:#8b5cf6;
  --amber:#fbbf24;
}
body{font-family:'Inter',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
a{color:var(--blue);text-decoration:none}
.container{max-width:1400px;margin:0 auto;padding:1rem}

header{background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border-bottom:1px solid var(--border);padding:1.5rem 0}
header .container{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:1rem}
.logo h1{font-size:1.5rem;font-weight:700}
.logo span{font-size:.85rem;color:var(--muted)}
.meta{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap}
.badge{font-size:.75rem;padding:.35rem .7rem;border-radius:6px;background:var(--surface);color:var(--muted);border:1px solid var(--border)}
.badge.highlight{background:rgba(59,130,246,.15);color:var(--blue);border-color:rgba(59,130,246,.3)}

.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem;margin:1.5rem 0}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:1rem}
.stat-card .label{font-size:.7rem;text-transform:uppercase;letter-spacing:.05em;color:var(--muted);margin-bottom:.3rem}
.stat-card .value{font-size:1.6rem;font-weight:700}
.stat-card .detail{font-size:.75rem;color:var(--muted);margin-top:.2rem}
.stat-card.hot .value{color:var(--red)}
.stat-card.cold .value{color:var(--blue)}
.stat-card.avg .value{color:var(--orange)}
.stat-card.count .value{color:var(--cyan)}
.stat-card.provs .value{color:var(--purple)}

.controls{display:flex;gap:.75rem;margin:1.5rem 0;flex-wrap:wrap;align-items:center}
.search-box{flex:1;min-width:200px;position:relative}
.search-box input{width:100%;padding:.55rem 1rem .55rem 2.4rem;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:.9rem;outline:none;transition:border-color .2s}
.search-box input:focus{border-color:var(--blue)}
.search-box svg{position:absolute;left:.75rem;top:50%;transform:translateY(-50%);color:var(--muted);width:16px;height:16px}
select.filter{padding:.55rem .75rem;background:var(--surface);border:1px solid var(--border);color:var(--text);border-radius:8px;font-size:.85rem;outline:none;cursor:pointer}
.btn-group{display:flex;gap:.2rem}
.btn-group button{padding:.45rem .65rem;background:var(--surface);border:1px solid var(--border);color:var(--muted);border-radius:6px;cursor:pointer;font-size:.75rem;transition:all .15s}
.btn-group button.active{background:var(--blue);color:#fff;border-color:var(--blue)}
.btn-group button:hover:not(.active){border-color:var(--blue)}
.btn-excel{padding:.45rem .85rem;background:var(--green);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:.75rem;font-weight:600;transition:opacity .15s}
.btn-excel:hover:not(:disabled){opacity:.85}
.btn-excel:disabled{background:var(--muted);cursor:not-allowed;opacity:.5}

.provinces-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:1rem;margin-bottom:1.5rem}
.prov-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;cursor:pointer;transition:transform .15s,box-shadow .15s}
.prov-card:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.3)}
.prov-card.expanded{grid-column:1/-1}
.prov-header{padding:.75rem;display:flex;justify-content:space-between;align-items:center;background:var(--surface2)}
.prov-header h3{font-size:.85rem;font-weight:600}
.prov-header .prov-stats{display:flex;gap:.5rem;font-size:.75rem}
.prov-header .t-min{color:var(--blue);font-weight:600}
.prov-header .t-max{color:var(--red);font-weight:600}
.prov-header .mun-count{color:var(--muted);font-size:.7rem}
.prov-body{padding:0;max-height:0;overflow:hidden;transition:max-height .3s}
.prov-card.expanded .prov-body{max-height:9999px}
.prov-temps{display:flex;justify-content:space-around;padding:.5rem .75rem .75rem;font-size:.8rem;color:var(--muted)}
.prov-temps strong{color:var(--fg)}

.prov-table{width:100%;border-collapse:collapse}
.prov-table th{padding:.5rem .75rem;text-align:left;font-size:.7rem;text-transform:uppercase;color:var(--muted);border-bottom:1px solid var(--border);background:var(--surface)}
.prov-table td{padding:.4rem .75rem;font-size:.85rem;border-bottom:1px solid rgba(71,85,105,.2)}
.prov-table tr:hover{background:rgba(59,130,246,.04)}
.prov-table tr.capital td{background:rgba(251,191,36,.06)}
.prov-table .city{font-weight:500}
.prov-table .city.is-capital{color:var(--amber);font-weight:700}
.prov-table .temp-min{color:var(--blue);font-weight:600;font-variant-numeric:tabular-nums}
.prov-table .temp-max{color:var(--red);font-weight:600;font-variant-numeric:tabular-nums}
.prov-table .temp-media{color:var(--orange);font-weight:600;font-variant-numeric:tabular-nums}

.table-wrap{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:1.5rem;display:none}
.table-wrap.visible{display:block}
.full-table{width:100%;border-collapse:collapse}
.full-table thead th{background:var(--surface2);padding:.6rem .75rem;text-align:left;font-size:.7rem;text-transform:uppercase;letter-spacing:.05em;color:var(--muted);border-bottom:1px solid var(--border);cursor:pointer;user-select:none;white-space:nowrap;position:sticky;top:0;z-index:1}
.full-table thead th:hover{color:var(--text)}
.full-table tbody tr{border-bottom:1px solid rgba(71,85,105,.2);transition:background .1s}
.full-table tbody tr:hover{background:rgba(59,130,246,.05)}
.full-table td{padding:.45rem .75rem;font-size:.85rem;white-space:nowrap}
.full-table .city{font-weight:500}
.full-table .city.is-capital{color:var(--amber);font-weight:700}
.full-table .prov{color:var(--muted);font-size:.8rem}
.full-table .temp-min{color:var(--blue);font-weight:600;text-align:center}
.full-table .temp-max{color:var(--red);font-weight:600;text-align:center}
.full-table .temp-media{color:var(--orange);font-weight:600;text-align:center}
.scroll-container{max-height:70vh;overflow-y:auto}

footer{text-align:center;padding:2rem 1rem;color:var(--muted);font-size:.75rem;border-top:1px solid var(--border)}
.loading{text-align:center;padding:4rem;color:var(--muted)}
.loading .spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--blue);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1rem}
@keyframes spin{to{transform:rotate(360deg)}}

@media(max-width:1200px){
  .provinces-grid{grid-template-columns:repeat(3,1fr)}
}
@media(max-width:768px){
  .stats{grid-template-columns:repeat(2,1fr)}
  .controls{flex-direction:column}
  .search-box{min-width:100%}
  .provinces-grid{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:480px){
  .provinces-grid{grid-template-columns:1fr}
}
</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
</head>
<body>

<header>
  <div class="container">
    <div class="logo">
      <h1>Temperaturas Espa&ntilde;a</h1>
      <span>AEMET OpenData &middot; Capitales de provincia</span>
    </div>
    <div class="meta">
      <span class="badge highlight" id="total-badge">Cargando...</span>
      <span class="badge" id="days-badge">--</span>
      <span class="badge" id="updated">--</span>
    </div>
  </div>
</header>

<main class="container">

  <div class="stats">
    <div class="stat-card hot"><div class="label">M&aacute;s caliente</div><div class="value" id="stat-hot">--</div><div class="detail" id="stat-hot-city">--</div></div>
    <div class="stat-card cold"><div class="label">M&aacute;s fr&iacute;a</div><div class="value" id="stat-cold">--</div><div class="detail" id="stat-cold-city">--</div></div>
    <div class="stat-card avg"><div class="label">Media Espa&ntilde;a</div><div class="value" id="stat-avg">--</div><div class="detail">M&iacute;n / M&aacute;x</div></div>
    <div class="stat-card count"><div class="label">Capitales</div><div class="value" id="stat-count">--</div><div class="detail" id="stat-ok">--</div></div>
    <div class="stat-card provs"><div class="label">Provincias</div><div class="value" id="stat-provs">--</div><div class="detail">con datos</div></div>
  </div>

  <div class="controls">
    <div class="search-box">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
      <input type="text" id="search" placeholder="Buscar municipio o provincia..." title="Buscar">
    </div>
    <select class="filter" id="date-filter" title="Filtrar por fecha">
      <option value="">Todas las fechas</option>
    </select>
    <select class="filter" id="prov-filter" title="Filtrar por provincia">
      <option value="">Todas las provincias</option>
    </select>
    <div class="btn-group">
      <button data-view="cards" class="active" title="Vista tarjetas">Provincias</button>
      <button data-view="table" title="Vista tabla">Tabla</button>
    </div>
    <div class="btn-group">
      <button data-sort="name" class="active">A-Z</button>
      <button data-sort="max-desc">M&aacute;x &darr;</button>
      <button data-sort="min-asc">M&iacute;n &uarr;</button>
    </div>
    <button class="btn-excel" id="btn-excel" title="Descargar Excel CSV">&#x1F4E5; Excel</button>
  </div>

  <div class="provinces-grid" id="provinces-grid"></div>

  <div class="table-wrap" id="table-view">
    <div class="scroll-container">
      <table class="full-table">
        <thead>
          <tr>
            <th>Municipio</th>
            <th>Provincia</th>
            <th>Fecha</th>
            <th style="text-align:center">M&iacute;n &deg;C</th>
            <th style="text-align:center">M&aacute;x &deg;C</th>
            <th style="text-align:center">Media &deg;C</th>
          </tr>
        </thead>
        <tbody id="full-tbody"></tbody>
      </table>
    </div>
  </div>

</main>

<footer>
  Datos de la Agencia Estatal de Meteorolog&iacute;a (AEMET) &middot; Actualizaci&oacute;n diaria autom&aacute;tica a las 11:30 CET &middot; &Uacute;ltimos 7 d&iacute;as
</footer>

<script>
let DATA = null;
let currentView = 'cards';
let currentSort = 'name';
let expandedProv = null;

async function init() {
  var grid = document.getElementById('provinces-grid');
  grid.innerHTML = '<div class="loading"><div class="spinner"></div>Cargando datos...</div>';
  try {
    var resp = await fetch('data.json?' + Date.now());
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    DATA = await resp.json();
    if (!DATA.registros || !DATA.registros.length) {
      grid.innerHTML = '<div class="loading">No hay registros. Ejecuta el script primero.</div>';
      return;
    }
    render();
  } catch (e) {
    grid.innerHTML = '<div class="loading">Error cargando datos: ' + e.message + '</div>';
    console.error('init error:', e);
  }
}

function formatDate(ds) {
  if (!ds) return '--';
  var p = ds.split('-');
  return parseInt(p[2]) + '/' + parseInt(p[1]) + '/' + p[0].slice(2);
}

function getFilteredRegistros() {
  if (!DATA || !DATA.registros) return [];
  var regs = DATA.registros;
  var dv = document.getElementById('date-filter').value;
  if (dv) regs = regs.filter(function(r){ return r.fecha === dv; });
  return regs;
}

function groupByProvince(registros) {
  var byProv = {};
  registros.forEach(function(r) {
    var p = r.provincia || 'Desconocida';
    if (!byProv[p]) byProv[p] = [];
    byProv[p].push(r);
  });
  return Object.keys(byProv).sort().map(function(nombre) {
    return { nombre: nombre, municipios: byProv[nombre] };
  });
}

function render() {
  if (!DATA) return;
  try {
    document.getElementById('updated').textContent = 'Actualizado: ' + (DATA.actualizado || '--');
    document.getElementById('total-badge').textContent = (DATA.total_municipios || 0) + ' municipios';
    var dias = DATA.dias_disponibles || [];
    document.getElementById('days-badge').textContent = dias.length + ' d\u00edas';

    // Date filter
    var dateFilter = document.getElementById('date-filter');
    var prevDate = dateFilter.value;
    dateFilter.innerHTML = '<option value="">Todas las fechas (' + dias.length + ' d\u00edas)</option>';
    dias.slice().reverse().forEach(function(d) {
      var opt = document.createElement('option');
      opt.value = d;
      opt.textContent = formatDate(d);
      dateFilter.appendChild(opt);
    });
    if (prevDate && dias.indexOf(prevDate) !== -1) {
      dateFilter.value = prevDate;
    } else if (dias.length > 0) {
      // Por defecto seleccionar la fecha m√°s reciente (hoy)
      dateFilter.value = dias[dias.length - 1];
    }

    // Province filter
    var provFilter = document.getElementById('prov-filter');
    var prevProv = provFilter.value;
    provFilter.innerHTML = '<option value="">Todas las provincias</option>';
    var provs = groupByProvince(getFilteredRegistros());
    provs.forEach(function(p) {
      var opt = document.createElement('option');
      opt.value = p.nombre;
      opt.textContent = p.nombre + ' (' + p.municipios.length + ')';
      provFilter.appendChild(opt);
    });
    if (prevProv) provFilter.value = prevProv;

    renderStats();
    renderProvinces();
    renderFullTable();
  } catch(e) {
    console.error('render error:', e);
    document.getElementById('provinces-grid').innerHTML = '<div class="loading">Error: ' + e.message + '</div>';
  }
}

function renderStats() {
  var all = getFilteredRegistros().filter(function(m){ return m.min !== null && m.max !== null; });
  if (!all.length) return;

  var hottest = all[0], coldest = all[0];
  var sumMin = 0, sumMax = 0;
  all.forEach(function(m) {
    if (m.max > hottest.max) hottest = m;
    if (m.min < coldest.min) coldest = m;
    sumMin += m.min;
    sumMax += m.max;
  });

  var provsSet = {};
  all.forEach(function(r){ provsSet[r.provincia] = true; });

  document.getElementById('stat-hot').textContent = hottest.max + '\u00b0';
  document.getElementById('stat-hot-city').textContent = hottest.nombre + ' (' + hottest.provincia + ')';
  document.getElementById('stat-cold').textContent = coldest.min + '\u00b0';
  document.getElementById('stat-cold-city').textContent = coldest.nombre + ' (' + coldest.provincia + ')';
  document.getElementById('stat-avg').textContent = Math.round(sumMin / all.length) + '\u00b0 / ' + Math.round(sumMax / all.length) + '\u00b0';
  document.getElementById('stat-count').textContent = DATA.total_municipios || 0;
  document.getElementById('stat-ok').textContent = all.length + ' registros';
  document.getElementById('stat-provs').textContent = Object.keys(provsSet).length;
}

function getFilteredProvinces() {
  var search = document.getElementById('search').value.toLowerCase();
  var provVal = document.getElementById('prov-filter').value;
  var provs = groupByProvince(getFilteredRegistros());

  if (provVal) {
    provs = provs.filter(function(p){ return p.nombre === provVal; });
  }
  if (search) {
    provs = provs.map(function(p) {
      var filtered = p.municipios.filter(function(m){
        return m.nombre.toLowerCase().indexOf(search) !== -1 ||
               (m.codigo || '').indexOf(search) !== -1 ||
               p.nombre.toLowerCase().indexOf(search) !== -1;
      });
      return filtered.length ? { nombre: p.nombre, municipios: filtered } : null;
    }).filter(Boolean);
  }
  return provs;
}

function sortMunicipios(list) {
  var s = list.slice();
  switch (currentSort) {
    case 'name': s.sort(function(a,b){ return a.nombre.localeCompare(b.nombre); }); break;
    case 'max-desc': s.sort(function(a,b){ return (b.max||0) - (a.max||0); }); break;
    case 'min-asc': s.sort(function(a,b){ return (a.min||99) - (b.min||99); }); break;
  }
  return s;
}

function renderProvinces() {
  var grid = document.getElementById('provinces-grid');
  var provs = getFilteredProvinces();

  var html = '';
  provs.forEach(function(p) {
    var valid = p.municipios.filter(function(m){ return m.min !== null && m.max !== null; });
    if (!valid.length) return;
    var mins = valid.map(function(m){ return m.min; });
    var maxs = valid.map(function(m){ return m.max; });
    var minVal = Math.min.apply(null, mins);
    var maxVal = Math.max.apply(null, maxs);
    var isExp = expandedProv === p.nombre;
    var sorted = sortMunicipios(p.municipios);

    var rows = '';
    sorted.forEach(function(m) {
      var isCap = m.capital;
      var mediaStr = (m.media !== null && m.media !== undefined) ? m.media.toFixed(1) + '\u00b0' : '-';
      rows += '<tr class="' + (isCap ? 'capital' : '') + '">';
      rows += '<td class="city ' + (isCap ? 'is-capital' : '') + '">' + m.nombre + (isCap ? ' \u2605' : '') + '</td>';
      rows += '<td class="temp-min">' + (m.min !== null ? m.min + '\u00b0' : '-') + '</td>';
      rows += '<td class="temp-max">' + (m.max !== null ? m.max + '\u00b0' : '-') + '</td>';
      rows += '<td class="temp-media">' + mediaStr + '</td>';
      rows += '</tr>';
    });

    var escapedName = p.nombre.replace(/'/g, "\\'");
    html += '<div class="prov-card ' + (isExp ? 'expanded' : '') + '" onclick="toggleProv(\'' + escapedName + '\')">';
    html += '<div class="prov-header"><div>';
    html += '<h3>' + p.nombre + '</h3>';
    html += '<span class="mun-count">' + valid.length + ' municipios</span>';
    html += '</div><div class="prov-stats">';
    html += '<span class="t-min">' + minVal + '\u00b0</span>';
    html += '<span style="color:var(--muted)"> / </span>';
    html += '<span class="t-max">' + maxVal + '\u00b0</span>';
    html += '</div></div>';
    html += '<div class="prov-body"><table class="prov-table">';
    html += '<thead><tr><th>Municipio</th><th>M\u00edn</th><th>M\u00e1x</th><th>Media</th></tr></thead>';
    html += '<tbody>' + rows + '</tbody></table></div></div>';
  });

  grid.innerHTML = html || '<div class="loading">No se encontraron resultados</div>';
}

function renderFullTable() {
  var tbody = document.getElementById('full-tbody');
  var provs = getFilteredProvinces();
  var all = [];
  provs.forEach(function(p) {
    p.municipios.forEach(function(m) {
      all.push(m);
    });
  });
  var sorted = sortMunicipios(all);

  var html = '';
  sorted.forEach(function(m) {
    var mediaStr = (m.media !== null && m.media !== undefined) ? m.media.toFixed(1) + '\u00b0' : '-';
    html += '<tr>';
    html += '<td class="city ' + (m.capital ? 'is-capital' : '') + '">' + m.nombre + (m.capital ? ' \u2605' : '') + '</td>';
    html += '<td class="prov">' + (m.provincia || '') + '</td>';
    html += '<td style="color:var(--muted)">' + formatDate(m.fecha) + '</td>';
    html += '<td class="temp-min">' + (m.min !== null ? m.min + '\u00b0' : '-') + '</td>';
    html += '<td class="temp-max">' + (m.max !== null ? m.max + '\u00b0' : '-') + '</td>';
    html += '<td class="temp-media">' + mediaStr + '</td>';
    html += '</tr>';
  });
  tbody.innerHTML = html;
}

function toggleProv(nombre) {
  expandedProv = (expandedProv === nombre) ? null : nombre;
  renderProvinces();
}

function updateView() {
  document.getElementById('provinces-grid').style.display = (currentView === 'cards') ? 'grid' : 'none';
  document.getElementById('table-view').className = 'table-wrap' + (currentView === 'table' ? ' visible' : '');
}

// Excel XLSX download
function isExcelAvailable() {
  var now = new Date();
  var h = now.getHours();
  var m = now.getMinutes();
  return (h > 11 || (h === 11 && m >= 30));
}

function updateExcelButton() {
  var btn = document.getElementById('btn-excel');
  if (!btn) return;
  if (isExcelAvailable()) {
    btn.disabled = false;
    btn.title = 'Descargar Excel (solo capitales)';
  } else {
    btn.disabled = true;
    btn.title = 'Disponible a partir de las 11:30';
  }
}

function downloadExcel() {
  if (!isExcelAvailable()) return;
  var regs = (DATA.registros || []).filter(function(r){ return r.capital && r.min !== null && r.max !== null; });
  regs.sort(function(a,b){
    var pa = (a.codigo || '').substring(0,2);
    var pb = (b.codigo || '').substring(0,2);
    if (pa < pb) return -1;
    if (pa > pb) return 1;
    if (a.fecha < b.fecha) return -1;
    if (a.fecha > b.fecha) return 1;
    return 0;
  });

  var rows = [['Provincia', 'Cod.INE', 'Fecha', 'M\u00e1xima', 'M\u00ednima', 'T']];
  regs.forEach(function(r) {
    // Convertir fecha a Date para que Excel la reconozca como fecha
    var parts = r.fecha.split('-');
    var fechaDate = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
    rows.push([
      parseInt((r.codigo || '').substring(0,2)) || '',
      parseInt(r.codigo) || r.codigo,
      fechaDate,
      r.max,
      r.min,
      r.media !== null && r.media !== undefined ? Math.round(r.media * 100) / 100 : ''
    ]);
  });

  var wb = XLSX.utils.book_new();
  var ws = XLSX.utils.aoa_to_sheet(rows, {cellDates: true});

  // Formato de fecha D/M/YY en columna C
  var range = XLSX.utils.decode_range(ws['!ref']);
  for (var row = 1; row <= range.e.r; row++) {
    var cellRef = XLSX.utils.encode_cell({r: row, c: 2});
    if (ws[cellRef]) ws[cellRef].z = 'd/m/yy';
  }

  ws['!cols'] = [{wch:10},{wch:10},{wch:10},{wch:9},{wch:9},{wch:9}];
  XLSX.utils.book_append_sheet(wb, ws, 'Temperaturas');
  XLSX.writeFile(wb, 'temperaturas_aemet_' + (new Date().toISOString().slice(0,10)) + '.xlsx');
}

// Events
document.getElementById('search').addEventListener('input', function() {
  renderProvinces();
  renderFullTable();
});

document.getElementById('date-filter').addEventListener('change', function() {
  expandedProv = null;
  render();
});

document.getElementById('prov-filter').addEventListener('change', function() {
  expandedProv = null;
  renderProvinces();
  renderFullTable();
});

document.getElementById('btn-excel').addEventListener('click', downloadExcel);

var viewBtns = document.querySelectorAll('[data-view]');
for (var i = 0; i < viewBtns.length; i++) {
  viewBtns[i].addEventListener('click', function() {
    for (var j = 0; j < viewBtns.length; j++) viewBtns[j].classList.remove('active');
    this.classList.add('active');
    currentView = this.getAttribute('data-view');
    updateView();
  });
}

var sortBtns = document.querySelectorAll('[data-sort]');
for (var i = 0; i < sortBtns.length; i++) {
  sortBtns[i].addEventListener('click', function() {
    for (var j = 0; j < sortBtns.length; j++) sortBtns[j].classList.remove('active');
    this.classList.add('active');
    currentSort = this.getAttribute('data-sort');
    renderProvinces();
    renderFullTable();
  });
}

init();
updateExcelButton();
setInterval(updateExcelButton, 60000);
</script>
</body>
</html>
